<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Air Mouse - Part√≠culas Interactivas</title>
    <style>
        /* 1. La P√°gina Web de fondo */
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; overflow: hidden; }
        
        #web-content {
            padding: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            z-index: 1;
        }

        .btn-test {
            padding: 20px 40px;
            font-size: 1.5rem;
            border: none;
            border-radius: 10px;
            background: #444;
            color: white;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        /* Estilo para cuando el mouse virtual est√° encima */
        .btn-test.hover { background: #00ffcc; color: black; transform: scale(1.1); }
        .btn-test:active { background: #ff0055; }

        /* 2. El Lienzo de Part√≠culas (Transparente y encima) */
        #canvas-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; /* Deja que el click pase a trav√©s */
            z-index: 10;
        }

        #input_video {
            position: fixed; bottom: 10px; right: 10px;
            width: 120px; border: 2px solid #00ffcc; border-radius: 10px;
            transform: scaleX(-1); z-index: 100;
        }

        #cursor-status {
            position: fixed; top: 10px; width: 100%; text-align: center;
            font-weight: bold; color: #00ffcc; text-shadow: 0 0 10px black;
        }
    </style>
</head>
<body>

    <div id="web-content">
        <h1>Navegador Espacial</h1>
        <p>Mueve tu mano para controlar el cursor de part√≠culas.</p>
        <button class="btn-test" onclick="alert('¬°Bot√≥n 1 Clicked!')">BOT√ìN M√ÅGICO 1</button>
        <button class="btn-test" onclick="alert('¬°Bot√≥n 2 Clicked!')">BOT√ìN M√ÅGICO 2</button>
        <button class="btn-test" onclick="this.style.borderRadius='50%'">REDONDEARME</button>
        <div id="debug" style="font-size: 0.8rem; color: gray;">Esperando c√°mara...</div>
    </div>

    <div id="cursor-status">üñêÔ∏è MANO ABIERTA (Mover)</div>
    <div id="canvas-container"></div>
    <video id="input_video" playsinline></video>

    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        // --- CONFIGURACI√ìN THREE.JS ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        camera.position.z = 5;

        // Part√≠culas del cursor
        const partCount = 500;
        const geo = new THREE.BufferGeometry();
        const pos = new Float32Array(partCount * 3);
        for(let i=0; i<partCount*3; i++) pos[i] = (Math.random()-0.5) * 2;
        geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));

        const mat = new THREE.PointsMaterial({ size: 0.05, color: 0x00ffcc, transparent: true, blending: THREE.AdditiveBlending });
        const particles = new THREE.Points(geo, mat);
        scene.add(particles);

        // --- L√ìGICA DE CONTROL ---
        let mouseX = 0, mouseY = 0;
        let isClosed = false;
        let lastElement = null;

        function onResults(results) {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const hand = results.multiHandLandmarks[0];
                const indexTip = hand[8];
                const thumbTip = hand[4];

                // Convertir coordenadas de c√°mara a coordenadas de pantalla (p√≠xeles)
                const screenX = (1 - indexTip.x) * window.innerWidth;
                const screenY = indexTip.y * window.innerHeight;

                // Mover part√≠culas de Three.js
                mouseX = (indexTip.x - 0.5) * -10;
                mouseY = (indexTip.y - 0.5) * -10;

                // DETECTAR CLICK (Distancia entre pulgar e √≠ndice)
                const dist = Math.hypot(indexTip.x - thumbTip.x, indexTip.y - thumbTip.y);
                const closedNow = dist < 0.05;

                // Simular Hover
                const element = document.elementFromPoint(screenX, screenY);
                if (element !== lastElement) {
                    if (lastElement) lastElement.classList.remove('hover');
                    if (element && element.classList.contains('btn-test')) element.classList.add('hover');
                    lastElement = element;
                }

                // Disparar Click Real
                if (closedNow && !isClosed) {
                    document.getElementById('cursor-status').innerText = "‚úä ¬°CLICK!";
                    mat.color.set(0xff0055);
                    if (element) element.click();
                } else if (!closedNow && isClosed) {
                    document.getElementById('cursor-status').innerText = "üñêÔ∏è MANO ABIERTA";
                    mat.color.set(0x00ffcc);
                }
                isClosed = closedNow;
                document.getElementById('debug').innerText = `X: ${Math.round(screenX)} Y: ${Math.round(screenY)}`;
            }
        }

        // --- INICIAR MEDIAPIPE ---
        const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
        hands.setOptions({ maxNumHands: 1, modelComplexity: 0, minDetectionConfidence: 0.7 });
        hands.onResults(onResults);

        const videoElement = document.getElementById('input_video');
        const cameraFeed = new Camera(videoElement, {
            onFrame: async () => { await hands.send({image: videoElement}); },
            width: 480, height: 360
        });
        cameraFeed.start();

        // --- RENDER ---
        function animate() {
            requestAnimationFrame(animate);
            particles.position.x += (mouseX - particles.position.x) * 0.2;
            particles.position.y += (mouseY - particles.position.y) * 0.2;
            particles.rotation.z += 0.02;
            
            // Efecto de escala al hacer click
            const targetScale = isClosed ? 0.5 : 1.0;
            particles.scale.lerp(new THREE.Vector3(targetScale, targetScale, targetScale), 0.2);

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
