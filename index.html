<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Air Mouse Elite - Ultra Smooth</title>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #050505; color: white; overflow-y: auto; height: 300vh; }
        
        #hud {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            padding: 12px 30px; background: rgba(0,0,0,0.8); border-radius: 50px;
            border: 2px solid #00ffcc; color: #00ffcc; z-index: 100; font-weight: bold;
            box-shadow: 0 0 20px rgba(0,255,204,0.4);
        }

        #web-content { display: flex; flex-direction: column; align-items: center; gap: 40px; padding-top: 150px; position: relative; z-index: 1; }

        .interactive-btn {
            width: 85%; max-width: 450px; padding: 35px; background: #111;
            border: 2px solid #222; border-radius: 25px; color: white; font-size: 1.4rem;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer;
        }
        .interactive-btn.hover-effect { 
            border-color: #00ffcc; background: rgba(0,255,204,0.1); 
            transform: scale(1.08); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; }
        #input_video { position: fixed; bottom: 15px; right: 15px; width: 110px; border-radius: 12px; transform: scaleX(-1); opacity: 0.4; border: 1px solid #00ffcc; }
    </style>
</head>
<body>

    <div id="hud">üñêÔ∏è GESTOS ACTIVOS | üé§ DI "CLICK"</div>

    <div id="web-content">
        <button class="interactive-btn" onclick="this.style.background='#00ffcc'; this.style.color='black';">Bot√≥n Principal</button>
        <button class="interactive-btn" onclick="alert('Voz o Gesto detectado')">Confirmar Acci√≥n</button>
        <div style="height: 400px; color: #444;">√Årea de Scroll (Usa Pulgar + Medio)</div>
        <button class="interactive-btn" onclick="location.reload()">Resetear Sistema</button>
    </div>

    <div id="canvas-container"></div>
    <video id="input_video" playsinline></video>

    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        // --- 1. RECONOCIMIENTO DE VOZ INSTANT√ÅNEO ---
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'es-ES';
        recognition.continuous = true;
        recognition.interimResults = true; // Permite detectar palabras antes de que termines de hablar

        recognition.onresult = (event) => {
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                const text = event.results[i][0].transcript.toLowerCase();
                if (text.includes("click") || text.includes("clic")) {
                    triggerAction();
                }
            }
        };
        recognition.onend = () => recognition.start();
        recognition.start();

        function triggerAction() {
            if (lastHovered) {
                lastHovered.click();
                if (navigator.vibrate) navigator.vibrate([50, 30, 50]);
                visualFeedback();
            }
        }

        function visualFeedback() {
            cursor.scale.set(1.5, 1.5, 1);
            cursorMat.color.set(0xff0055);
            setTimeout(() => {
                cursor.scale.set(1, 1, 1);
                cursorMat.color.set(0x00ffcc);
            }, 200);
        }

        // --- 2. THREE.JS (Cursor m√°s grande y fluido) ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const cursorMat = new THREE.MeshBasicMaterial({ color: 0x00ffcc, transparent: true, opacity: 0.8 });
        // Cursor m√°s grande (0.12 radio)
        const cursor = new THREE.Mesh(new THREE.RingGeometry(0.09, 0.13, 32), cursorMat);
        scene.add(cursor);

        // Variables de suavizado (EMA)
        let smoothX = 0, smoothY = 0;
        let lastHovered = null;
        const SENSITIVITY = 2.8;

        function onResults(results) {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const hand = results.multiHandLandmarks[0];
                const index = hand[8], thumb = hand[4], middle = hand[12];

                // Mapeo con sensibilidad aumentada
                const targetX = (index.x - 0.5) * -11 * SENSITIVITY;
                const targetY = (index.y - 0.5) * -11 * SENSITIVITY;

                // FILTRO DE FLUIDEZ (Interpola el 15% de la nueva posici√≥n cada frame)
                smoothX += (targetX - smoothX) * 0.15;
                smoothY += (targetY - smoothY) * 0.15;
                cursor.position.set(smoothX, smoothY, 0);

                // Coordenadas de pantalla para el click
                const screenX = (0.5 - (index.x - 0.5) * SENSITIVITY) * window.innerWidth;
                const screenY = (0.5 + (index.y - 0.5) * SENSITIVITY) * window.innerHeight;

                const el = document.elementFromPoint(screenX, screenY);
                if (el !== lastHovered) {
                    if (lastHovered) lastHovered.classList.remove('hover-effect');
                    if (el && el.classList.contains('interactive-btn')) el.classList.add('hover-effect');
                    lastHovered = el;
                }

                // GESTOS MANUALES (Siguen funcionando)
                const dIdx = Math.hypot(index.x-thumb.x, index.y-thumb.y);
                const dMid = Math.hypot(middle.x-thumb.x, middle.y-thumb.y);

                if (dMid < 0.05) { // SCROLL con dedo medio
                    window.scrollBy(0, (index.y - 0.5) * 100);
                    cursorMat.color.set(0xff00ff);
                } else if (dIdx < 0.05) { // CLICK con √≠ndice
                    triggerAction();
                } else {
                    cursorMat.color.set(0x00ffcc);
                }
            }
        }

        const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
        hands.setOptions({ maxNumHands: 1, modelComplexity: 0, minDetectionConfidence: 0.7 });
        hands.onResults(onResults);

        const videoElement = document.getElementById('input_video');
        const cam = new Camera(videoElement, {
            onFrame: async () => { await hands.send({image: videoElement}); },
            width: 640, height: 480
        });
        cam.start();

        function animate() { requestAnimationFrame(animate); renderer.render(scene, camera); }
        animate();
    </script>
</body>
</html>
