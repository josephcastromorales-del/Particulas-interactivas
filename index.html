<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TechStore OS - Advanced Interface</title>
    <style>
        :root { --accent: #00ffcc; --bg: #0a0a0a; --card: #151515; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: white; transition: filter 0.5s, background 0.5s; overflow: hidden; height: 100vh; }
        
        /* Modo Nocturno Dinámico */
        body.dark-mode { filter: brightness(0.3) contrast(1.2); background: #000; }

        header { padding: 20px; text-align: center; border-bottom: 1px solid #222; }
        
        #shop-viewport { 
            height: 80vh; overflow: hidden; display: flex; align-items: center; justify-content: center;
        }
        
        #shop-content { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; padding: 40px;
            transition: transform 0.3s cubic-bezier(0.2, 0, 0.2, 1);
            transform-origin: center;
        }

        .product-card {
            background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid #333;
            text-align: center; width: 200px; transition: 0.3s;
        }
        .product-card.hover-effect { border-color: var(--accent); box-shadow: 0 0 20px rgba(0,255,204,0.2); }

        /* Menú Radial HTML */
        #radial-menu {
            position: fixed; width: 150px; height: 150px; pointer-events: none;
            display: none; z-index: 1000;
        }
        .radial-item {
            position: absolute; width: 40px; height: 40px; background: var(--accent);
            border-radius: 50%; color: black; display: flex; align-items: center;
            justify-content: center; font-size: 10px; font-weight: bold;
            transition: 0.3s; transform: scale(0);
        }

        #activate-btn {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 2000; padding: 15px 40px; background: var(--accent);
            border: none; border-radius: 50px; font-weight: bold; cursor: pointer;
        }

        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 500; }
        #input_video { position: fixed; top: 10px; right: 10px; width: 80px; opacity: 0.3; transform: scaleX(-1); border-radius: 10px; }
    </style>
</head>
<body>

    <button id="activate-btn">INICIALIZAR SISTEMA</button>

    <div id="radial-menu">
        <div class="radial-item" style="top:0; left:55px;">INFO</div>
        <div class="radial-item" style="bottom:0; left:55px;">SAVE</div>
        <div class="radial-item" style="top:55px; right:0;">BUY</div>
    </div>

    <header><h1>TECH<span style="color:var(--accent)">OS</span></h1></header>

    <div id="shop-viewport">
        <div id="shop-content">
            <div class="product-card interactive"><h3>Pod Pro</h3><p>$200</p></div>
            <div class="product-card interactive"><h3>VR Glass</h3><p>$500</p></div>
            <div class="product-card interactive"><h3>Drone X</h3><p>$800</p></div>
        </div>
    </div>

    <div id="canvas-container"></div>
    <video id="input_video" playsinline></video>

    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        let smoothX = 0, smoothY = 0, zoomLevel = 1, lastDist = 0;
        let hoverTimer, radialActive = false;
        let lastHovered = null;

        // --- Three.js Engine ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const cursor = new THREE.Mesh(
            new THREE.RingGeometry(0.1, 0.13, 32),
            new THREE.MeshBasicMaterial({ color: 0x00ffcc })
        );
        scene.add(cursor);

        // --- Lógica de Procesamiento ---
        function onResults(results) {
            const hands = results.multiHandLandmarks;
            const shop = document.getElementById('shop-content');

            if (hands && hands.length > 0) {
                // MANO 1: Control de Cursor y Menú Radial
                const h1 = hands[0];
                const index = h1[8], thumb = h1[4];
                
                // Movimiento Fluido
                const tx = (index.x - 0.5) * -15;
                const ty = (index.y - 0.5) * -10;
                smoothX += (tx - smoothX) * 0.15;
                smoothY += (ty - smoothY) * 0.15;
                cursor.position.set(smoothX, smoothY, 0);

                // Mapeo a Pantalla
                const sx = (0.5 - (index.x - 0.5) * 2.5) * window.innerWidth;
                const sy = (0.5 + (index.y - 0.5) * 2.5) * window.innerHeight;
                const el = document.elementFromPoint(sx, sy);
                const card = el ? el.closest('.product-card') : null;

                // Lógica de Menú Radial (Hover sostenido)
                if (card) {
                    if (card !== lastHovered) {
                        clearTimeout(hoverTimer);
                        hideRadial();
                        lastHovered = card;
                        card.classList.add('hover-effect');
                        hoverTimer = setTimeout(() => showRadial(sx, sy), 1000);
                    }
                } else {
                    clearTimeout(hoverTimer);
                    hideRadial();
                    if (lastHovered) lastHovered.classList.remove('hover-effect');
                    lastHovered = null;
                }

                // MODO NOCTURNO: Basado en el tamaño de la mano (eje Z aproximado)
                const handSize = Math.hypot(h1[0].x - h1[9].x, h1[0].y - h1[9].y);
                if (handSize < 0.1) document.body.classList.add('dark-mode');
                else document.body.classList.remove('dark-mode');

                // MANO 2: SOPORTE MULTITOUCH (ZOOM)
                if (hands.length === 2) {
                    const h2 = hands[1];
                    const currentDist = Math.hypot(h1[8].x - h2[8].x, h1[8].y - h2[8].y);
                    
                    if (lastDist > 0) {
                        const diff = currentDist - lastDist;
                        zoomLevel += diff * 2;
                        zoomLevel = Math.max(0.5, Math.min(2, zoomLevel));
                        shop.style.transform = `scale(${zoomLevel})`;
                    }
                    lastDist = currentDist;
                    cursor.material.color.set(0xffff00); // Cambio a amarillo en modo Multitouch
                } else {
                    lastDist = 0;
                    cursor.material.color.set(0x00ffcc);
                }
            }
        }

        function showRadial(x, y) {
            const menu = document.getElementById('radial-menu');
            menu.style.display = 'block';
            menu.style.left = (x - 75) + 'px';
            menu.style.top = (y - 75) + 'px';
            document.querySelectorAll('.radial-item').forEach(item => item.style.transform = 'scale(1)');
            radialActive = true;
        }

        function hideRadial() {
            document.querySelectorAll('.radial-item').forEach(item => item.style.transform = 'scale(0)');
            setTimeout(() => { if(!radialActive) document.getElementById('radial-menu').style.display = 'none'; }, 300);
            radialActive = false;
        }

        // --- Inicialización ---
        document.getElementById('activate-btn').onclick = function() {
            this.style.display = 'none';
            const handExt = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
            handExt.setOptions({ maxNumHands: 2, modelComplexity: 1, minDetectionConfidence: 0.6 });
            handExt.onResults(onResults);

            new Camera(document.getElementById('input_video'), {
                onFrame: async () => { await handExt.send({image: document.getElementById('input_video')}); },
                width: 640, height: 480
            }).start();
        };

        function animate() { requestAnimationFrame(animate); renderer.render(scene, camera); }
        animate();
    </script>
</body>
</html>
