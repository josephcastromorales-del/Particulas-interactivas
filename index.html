<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechOS Ultra-Optimized</title>
    <style>
        :root { --accent: #00ffcc; --bg: #050505; }
        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none !important; }
        
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; transition: 0.3s; }
        
        /* FILTRO VISIÓN NOCTURNA */
        body.nv-mode { filter: brightness(1.4) contrast(1.2) sepia(1) hue-rotate(80deg) saturate(4); }
        body.nv-mode::after { content: ""; position: fixed; inset: 0; background: repeating-linear-gradient(0deg, rgba(0,255,0,0.05) 0px, rgba(0,255,0,0.05) 1px, transparent 2px); pointer-events: none; z-index: 10000; }

        header { padding: 20px; text-align: center; border-bottom: 1px solid #222; position: relative; z-index: 10; }
        
        #viewport { height: 80vh; display: flex; align-items: center; justify-content: center; gap: 30px; position: relative; z-index: 10; }

        /* CLASE UNIVERSAL: Cualquier elemento con 'interactive' o un link funcionará */
        .interactive {
            background: #111; padding: 25px; border-radius: 15px; border: 1px solid #333;
            text-align: center; min-width: 150px; transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .interactive.hover-effect { border-color: var(--accent); box-shadow: 0 0 25px rgba(0,255,204,0.3); transform: scale(1.05); }
        .interactive a { color: var(--accent); text-decoration: none; font-weight: bold; }

        #canvas-container { position: fixed; inset: 0; pointer-events: none; z-index: 9999; }
        #input_video { position: fixed; bottom: 10px; left: 10px; width: 120px; opacity: 0.4; transform: scaleX(-1); border-radius: 10px; z-index: 100; }

        #activate-btn {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 10001; padding: 20px 40px; background: var(--accent); color: black;
            border: none; border-radius: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 0 30px var(--accent);
        }
    </style>
</head>
<body>

    <button id="activate-btn">INICIAR SISTEMA CORE</button>

    <header><h1>TECH<span style="color:var(--accent)">OS</span> v2.0</h1></header>

    <div id="viewport">
        <div class="interactive">
            <a href="https://youtube.com" target="_blank">YOUTUBE</a>
        </div>

        <div class="interactive" onclick="document.body.classList.toggle('nv-mode')">
            <p>VISIÓN NOCTURNA</p>
        </div>

        <div class="interactive" onclick="alert('Sistema Optimizado')">
            <p>ESTADO</p>
        </div>
    </div>

    <div id="canvas-container"></div>
    <video id="input_video" playsinline></video>

    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        let sx = 0, sy = 0, lastH = null, canClick = true;

        // --- MOTOR 3D LITE ---
        const scene = new THREE.Scene();
        const cam3d = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 100);
        cam3d.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(1);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const cursor = new THREE.Group();
        const dot = new THREE.Mesh(new THREE.SphereGeometry(0.12, 16, 16), new THREE.MeshBasicMaterial({ color: 0x00ffcc }));
        const ring = new THREE.Mesh(new THREE.RingGeometry(0.18, 0.22, 32), new THREE.MeshBasicMaterial({ color: 0x00ffcc, transparent: true, opacity: 0.5 }));
        cursor.add(dot, ring);
        scene.add(cursor);

        // --- PROCESAMIENTO IA ---
        function onResults(res) {
            if (res.multiHandLandmarks && res.multiHandLandmarks[0]) {
                const hand = res.multiHandLandmarks[0];
                const index = hand[8], thumb = hand[4];

                // Movimiento Suavizado
                const tx = (index.x - 0.5) * -14;
                const ty = (index.y - 0.5) * -10;
                sx += (tx - sx) * 0.25; sy += (ty - sy) * 0.25;
                cursor.position.set(sx, sy, 0);
                ring.rotation.z += 0.05;

                // Coordenadas de pantalla
                const px = (0.5 - (index.x - 0.5) * 2.5) * window.innerWidth;
                const py = (0.5 + (index.y - 0.5) * 2.5) * window.innerHeight;

                // DETECCIÓN UNIVERSAL (No necesitas tocar el JS)
                const hit = document.elementFromPoint(px, py);
                const target = hit ? hit.closest('.interactive, a, button') : null;

                if (target !== lastH) {
                    if (lastH) lastH.classList.remove('hover-effect');
                    if (target) target.classList.add('hover-effect');
                    lastH = target;
                }

                // GESTO DE PELLIZCO (CLICK)
                const dist = Math.hypot(index.x - thumb.x, index.y - thumb.y);
                if (dist < 0.04 && canClick) {
                    if (target) {
                        cursor.scale.set(0.6, 0.6, 1);
                        if (target.tagName === 'A') window.open(target.href, '_blank');
                        else target.click();
                        canClick = false; 
                        setTimeout(() => canClick = true, 800); // Evita dobles clicks
                    }
                } else if (dist > 0.06) {
                    cursor.scale.set(1, 1, 1);
                }
            }
        }

        // --- INICIALIZACIÓN ---
        document.getElementById('activate-btn').onclick = function() {
            this.style.display = 'none';
            const hands = new Hands({ locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}` });
            hands.setOptions({ maxNumHands: 1, modelComplexity: 0, minDetectionConfidence: 0.7 });
            hands.onResults(onResults);

            new Camera(document.getElementById('input_video'), {
                onFrame: async () => { if(!document.hidden) await hands.send({image: document.getElementById('input_video')}); },
                width: 480, height: 360
            }).start();
        };

        function animate() { requestAnimationFrame(animate); renderer.render(scene, cam3d); }
        animate();

        window.onresize = () => {
            cam3d.aspect = window.innerWidth / window.innerHeight;
            cam3d.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>
