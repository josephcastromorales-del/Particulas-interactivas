<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TechStore - Modo Espacial</title>
    <style>
        :root { --accent: #00ffcc; --bg: #0a0a0a; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: white; overflow-x: hidden; }

        /* --- Estilos de la Tienda --- */
        header { padding: 20px; text-align: center; border-bottom: 1px solid #222; background: #111; }
        .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; padding: 20px; max-width: 1200px; margin: 0 auto; }
        
        .product-card {
            background: #1a1a1a; border-radius: 20px; padding: 20px; border: 1px solid #333;
            transition: all 0.3s ease; text-align: center;
        }
        .product-card.hover-effect { border-color: var(--accent); transform: translateY(-10px); box-shadow: 0 10px 30px rgba(0,255,204,0.2); }
        .product-card img { width: 100%; border-radius: 15px; margin-bottom: 15px; background: #333; height: 150px; object-fit: cover; }
        
        .buy-btn {
            background: var(--accent); color: black; border: none; padding: 12px 25px;
            border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; width: 100%;
        }

        /* --- Bot√≥n de Activaci√≥n --- */
        #activate-btn {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 200; padding: 15px 30px; background: var(--accent);
            color: black; border: none; border-radius: 50px; font-weight: bold;
            box-shadow: 0 0 20px rgba(0,255,204,0.5); cursor: pointer; font-size: 1rem;
        }
        #activate-btn.active { background: #ff3366; color: white; }

        /* --- Elementos del Sistema (Ocultos por defecto) --- */
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; display: none; }
        #input_video { position: fixed; top: 20px; right: 20px; width: 100px; border-radius: 10px; transform: scaleX(-1); border: 2px solid var(--accent); display: none; z-index: 150; }
        #hud { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 150; background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 20px; border: 1px solid var(--accent); display: none; }
    </style>
</head>
<body>

    <header>
        <h1>TECH<span style="color:var(--accent)">STORE</span></h1>
        <p>La tienda del futuro</p>
    </header>

    <button id="activate-btn">‚ú® ACTIVAR CONTROL ESPACIAL</button>

    <div id="hud">üé§ Di "CLICK" | üñêÔ∏è Navega</div>

    <div class="container" id="shop-content">
        </div>

    <div id="canvas-container"></div>
    <video id="input_video" playsinline></video>

    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        // --- 1. Llenar la tienda ---
        const shop = document.getElementById('shop-content');
        const products = [
            {n: "Neuro-Link Pro", p: "$2,999"}, {n: "Gafas AR-X", p: "$1,200"},
            {n: "Drone Stealth", p: "$850"}, {n: "Holograma Personal", p: "$450"},
            {n: "Cyber-Watch", p: "$350"}, {n: "Silla Gravity", p: "$1,100"}
        ];

        products.forEach(prod => {
            shop.innerHTML += `
                <div class="product-card interactive-btn">
                    <img src="https://via.placeholder.com/300x150/222/00ffcc?text=${prod.n}" alt="product">
                    <h3>${prod.n}</h3>
                    <p style="color:var(--accent)">${prod.p}</p>
                    <button class="buy-btn" onclick="alert('A√±adido: ${prod.n}')">COMPRAR</button>
                </div>
            `;
        });

        // --- 2. L√≥gica de Activaci√≥n ---
        let systemActive = false;
        const btn = document.getElementById('activate-btn');

        btn.onclick = () => {
            if (!systemActive) {
                startSystem();
                btn.innerText = "‚ùå DESACTIVAR C√ÅMARA";
                btn.classList.add('active');
                document.getElementById('canvas-container').style.display = 'block';
                document.getElementById('input_video').style.display = 'block';
                document.getElementById('hud').style.display = 'block';
            } else {
                location.reload(); // Forma m√°s limpia de detener c√°mara y procesos
            }
            systemActive = !systemActive;
        };

        // --- 3. Motor del Mouse Espacial ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const cursorMat = new THREE.MeshBasicMaterial({ color: 0x00ffcc, transparent: true, opacity: 0.8 });
        const cursor = new THREE.Mesh(new THREE.RingGeometry(0.1, 0.14, 32), cursorMat);
        scene.add(cursor);

        let smoothX = 0, smoothY = 0, lastHovered = null;
        const SENS = 3.2;

        function startSystem() {
            // Iniciar Voz
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'es-ES';
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.onresult = (e) => {
                const text = e.results[e.results.length-1][0].transcript.toLowerCase();
                if (text.includes("click") || text.includes("clic")) doAction();
            };
            recognition.start();

            // Iniciar Manos
            const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
            hands.setOptions({ maxNumHands: 1, modelComplexity: 0, minDetectionConfidence: 0.7 });
            hands.onResults(onResults);

            const cam = new Camera(document.getElementById('input_video'), {
                onFrame: async () => { await hands.send({image: document.getElementById('input_video')}); },
                width: 640, height: 480
            });
            cam.start();
        }

        function onResults(results) {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const hand = results.multiHandLandmarks[0];
                const index = hand[8], thumb = hand[4], middle = hand[12];

                // Movimiento ultra fluido
                const tx = (index.x - 0.5) * -12 * SENS;
                const ty = (index.y - 0.5) * -12 * SENS;
                smoothX += (tx - smoothX) * 0.2;
                smoothY += (ty - smoothY) * 0.2;
                cursor.position.set(smoothX, smoothY, 0);

                const sx = (0.5 - (index.x - 0.5) * SENS) * window.innerWidth;
                const sy = (0.5 + (index.y - 0.5) * SENS) * window.innerHeight;

                const el = document.elementFromPoint(sx, sy);
                const targetEl = el ? el.closest('.interactive-btn, .buy-btn') : null;

                if (targetEl !== lastHovered) {
                    if (lastHovered) lastHovered.classList.remove('hover-effect');
                    if (targetEl) targetEl.classList.add('hover-effect');
                    lastHovered = targetEl;
                }

                // Gestos
                if (Math.hypot(middle.x-thumb.x, middle.y-thumb.y) < 0.05) {
                    window.scrollBy(0, (index.y - 0.5) * 120);
                    cursorMat.color.set(0xff00ff);
                } else if (Math.hypot(index.x-thumb.x, index.y-thumb.y) < 0.05) {
                    doAction();
                } else {
                    cursorMat.color.set(0x00ffcc);
                }
            }
        }

        function doAction() {
            if (lastHovered) {
                lastHovered.click();
                cursor.scale.set(1.6, 1.6, 1);
                setTimeout(() => cursor.scale.set(1, 1, 1), 200);
                if (navigator.vibrate) navigator.vibrate(40);
            }
        }

        function animate() { requestAnimationFrame(animate); renderer.render(scene, camera); }
        animate();
    </script>
</body>
</html>
