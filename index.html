<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimized OS</title>
    <style>
        :root { --a: #00ffcc; --bg: #050505; }
        * { margin:0; padding:0; box-sizing:border-box; cursor:none !important; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        /* Capa de Renderizado */
        #c { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:99; }
        
        /* UI Minimalista */
        #ui { position:relative; z-index:10; display:grid; grid-template-columns:repeat(3, 1fr); gap:20px; padding:100px 50px; }
        .card { background:#111; padding:30px; border-radius:15px; border:1px solid #222; text-align:center; transition:0.2s; }
        .card.active { border-color:var(--a); transform: scale(1.05); box-shadow: 0 0 20px rgba(0,255,204,0.2); }
        
        #btn { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:100; padding:20px 40px; 
               background:var(--a); border:none; border-radius:50px; font-weight:bold; cursor:pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        #v { position:fixed; bottom:10px; right:10px; width:100px; height:75px; opacity:0.4; transform:scaleX(-1); border-radius:8px; z-index:5; }
    </style>
</head>
<body>

    <button id="btn">ACTIVAR CORE</button>
    <video id="v" playsinline></video>
    <canvas id="c"></canvas>

    <div id="ui">
        <div class="card"><h3>NEURAL</h3><p>$100</p></div>
        <div class="card"><h3>OPTIC</h3><p>$200</p></div>
        <div class="card"><h3>CYBER</h3><p>$300</p></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        const btn = document.getElementById('btn');
        const video = document.getElementById('v');
        let skipFrame = 0;
        let sx = 0, sy = 0, lastEl = null;

        // --- OPTIMIZACIÓN 1: Scene de bajo consumo ---
        const scene = new THREE.Scene();
        const cam3d = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 100);
        cam3d.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('c'), alpha: true, antialias: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(1); // Forzar 1 para ahorrar GPU en pantallas Retina/4K

        // Geometría compartida (instanciada en memoria)
        const dot = new THREE.Mesh(
            new THREE.SphereGeometry(0.12, 16, 16), 
            new THREE.MeshBasicMaterial({ color: 0x00ffcc })
        );
        scene.add(dot);

        // --- OPTIMIZACIÓN 2: Procesamiento de IA Eficiente ---
        function onResults(res) {
            // Saltamos cada 2 cuadros para liberar CPU (30fps de IA es suficiente para 60fps de visual)
            skipFrame++;
            if (skipFrame % 2 !== 0) return; 

            if (res.multiHandLandmarks && res.multiHandLandmarks[0]) {
                const h = res.multiHandLandmarks[0][8];
                
                // Suavizado cinemático (Lerp)
                const tx = (h.x - 0.5) * -14;
                const ty = (h.y - 0.5) * -10;
                sx += (tx - sx) * 0.25; 
                sy += (ty - sy) * 0.25;
                dot.position.set(sx, sy, 0);

                // Hitbox detection optimizada
                const px = (0.5 - (h.x - 0.5) * 2.5) * window.innerWidth;
                const py = (0.5 + (h.y - 0.5) * 2.5) * window.innerHeight;
                const el = document.elementFromPoint(px, py)?.closest('.card');

                if (el !== lastEl) {
                    if (lastEl) lastEl.classList.remove('active');
                    if (el) el.classList.add('active');
                    lastEl = el;
                }
            }
        }

        // --- OPTIMIZACIÓN 3: Inicialización Controlada ---
        btn.onclick = async () => {
            btn.style.display = 'none';
            
            const hands = new Hands({ locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}` });
            hands.setOptions({ 
                maxNumHands: 1, 
                modelComplexity: 0, // 0 = Lite (Más rápido), 1 = Full
                minDetectionConfidence: 0.6 
            });
            hands.onResults(onResults);

            const cam = new Camera(video, {
                onFrame: async () => { 
                    if (!document.hidden) await hands.send({image: video}); 
                },
                width: 480, height: 360 // Resolución menor para procesamiento ultra rápido
            });
            cam.start();
        };

        // Loop de Renderizado de alta frecuencia (60fps)
        function anim() {
            requestAnimationFrame(anim);
            renderer.render(scene, cam3d);
        }
        anim();

        window.onresize = () => {
            cam3d.aspect = window.innerWidth / window.innerHeight;
            cam3d.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>
