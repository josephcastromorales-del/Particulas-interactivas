<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TechStore OS - Universal Interface</title>
    <style>
        :root { --accent: #00ffcc; --bg: #0a0a0a; --card: #151515; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: white; overflow: hidden; height: 100vh; }
        
        header { padding: 20px; text-align: center; border-bottom: 1px solid #222; }
        
        #shop-viewport { height: 80vh; display: flex; align-items: center; justify-content: center; }
        #shop-content { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; padding: 40px; transition: transform 0.3s; }

        /* Cualquier cosa con la clase 'interactive' se verá así al señalarla */
        .interactive {
            background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid #333;
            text-align: center; width: 200px; transition: 0.3s; cursor: pointer;
        }
        .interactive.hover-effect { 
            border-color: var(--accent); 
            box-shadow: 0 0 20px rgba(0,255,204,0.4); 
            transform: scale(1.05);
        }

        #activate-btn {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 2000; padding: 15px 40px; background: var(--accent);
            border: none; border-radius: 50px; font-weight: bold; cursor: pointer;
        }

        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 500; }
        #input_video { position: fixed; top: 10px; right: 10px; width: 80px; opacity: 0.3; transform: scaleX(-1); border-radius: 10px; }
    </style>
</head>
<body>

    <button id="activate-btn">INICIALIZAR SISTEMA</button>

    <header><h1>TECH<span style="color:var(--accent)">OS</span></h1></header>

    <div id="shop-viewport">
        <div id="shop-content">
            <div class="interactive" onclick="alert('Compraste Pod Pro')"><h3>Pod Pro</h3><p>$200</p></div>
            
            <button class="interactive" onclick="console.log('Botón presionado')" style="height: 100px;">BOTÓN TEST</button>
            
            <div class="interactive" onclick="this.style.background='red'"><h3>Cambia Color</h3></div>
        </div>
    </div>

    <div id="canvas-container"></div>
    <video id="input_video" playsinline></video>

    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        let smoothX = 0, smoothY = 0;
        let lastHovered = null;

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const cursor = new THREE.Mesh(
            new THREE.RingGeometry(0.1, 0.14, 32),
            new THREE.MeshBasicMaterial({ color: 0x00ffcc })
        );
        scene.add(cursor);

        function onResults(results) {
            const hands = results.multiHandLandmarks;
            if (hands && hands.length > 0) {
                const h1 = hands[0];
                const index = h1[8], thumb = h1[4];

                // Movimiento
                const tx = (index.x - 0.5) * -15;
                const ty = (index.y - 0.5) * -10;
                smoothX += (tx - smoothX) * 0.2;
                smoothY += (ty - smoothY) * 0.2;
                cursor.position.set(smoothX, smoothY, 0);

                // Mapeo de pantalla
                const sx = (0.5 - (index.x - 0.5) * 2.5) * window.innerWidth;
                const sy = (0.5 + (index.y - 0.5) * 2.5) * window.innerHeight;
                
                // --- DETECCIÓN UNIVERSAL ---
                const el = document.elementFromPoint(sx, sy);
                // Busca el elemento más cercano que sea interactivo (por clase o por tener un onclick)
                const target = el ? el.closest('.interactive, [onclick], button') : null;

                if (target !== lastHovered) {
                    if (lastHovered) lastHovered.classList.remove('hover-effect');
                    if (target) target.classList.add('hover-effect');
                    lastHovered = target;
                }

                // --- CLIC POR PELLIZCO (PINCH) ---
                const dist = Math.hypot(index.x - thumb.x, index.y - thumb.y);
                if (dist < 0.04) { // Si los dedos se tocan
                    cursor.scale.set(0.5, 0.5, 0.5);
                    if (target) {
                        target.click(); // Ejecuta el click real de HTML
                        // Evitamos clicks repetidos infinitos mientras mantienes el pellizco
                        thumb.x = 100; 
                    }
                } else {
                    cursor.scale.set(1, 1, 1);
                }
            }
        }

        document.getElementById('activate-btn').onclick = function() {
            this.style.display = 'none';
            const handExt = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
            handExt.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7 });
            handExt.onResults(onResults);
            new Camera(document.getElementById('input_video'), {
                onFrame: async () => { await handExt.send({image: document.getElementById('input_video')}); },
                width: 640, height: 480
            }).start();
        };

        function animate() { requestAnimationFrame(animate); renderer.render(scene, camera); }
        animate();
    </script>
</body>
</html>
