<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Air Mouse - Voz + Gestos</title>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #0a0a0a; color: white; overflow: hidden; height: 100vh; }
        
        #hud {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            padding: 10px 25px; background: rgba(0,255,204,0.15); border-radius: 50px;
            border: 1px solid #00ffcc; color: #00ffcc; z-index: 100; text-align: center;
        }

        .btn-box {
            display: flex; flex-direction: column; align-items: center; gap: 20px; padding-top: 120px;
        }

        .interactive-btn {
            width: 80%; max-width: 300px; padding: 30px; background: #1a1a1a;
            border: 2px solid #333; border-radius: 20px; color: white; font-size: 1.2rem;
            transition: 0.2s; cursor: pointer;
        }
        .interactive-btn.hover-effect { border-color: #00ffcc; transform: scale(1.05); box-shadow: 0 0 20px rgba(0,255,204,0.3); }

        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        #input_video { position: fixed; bottom: 10px; right: 10px; width: 80px; opacity: 0.3; transform: scaleX(-1); }
    </style>
</head>
<body>

    <div id="hud">üé§ Di "CLICK" para activar | üñêÔ∏è Navega</div>

    <div class="btn-box">
        <button class="interactive-btn" onclick="alert('Acci√≥n por VOZ 1')">Bot√≥n Alpha</button>
        <button class="interactive-btn" onclick="alert('Acci√≥n por VOZ 2')">Bot√≥n Beta</button>
        <button class="interactive-btn" onclick="document.body.style.background='#1a0033'">Cambiar Color</button>
    </div>

    <div id="canvas-container"></div>
    <video id="input_video" playsinline></video>

    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        // --- 1. RECONOCIMIENTO DE VOZ ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'es-ES';
        recognition.continuous = true;
        recognition.interimResults = false;

        recognition.onresult = (event) => {
            const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
            console.log("Voz detectada:", transcript);

            if (transcript.includes("click") || transcript.includes("clic")) {
                executeVoiceClick();
            }
        };

        // Reiniciar si se detiene autom√°ticamente
        recognition.onend = () => recognition.start();
        recognition.start();

        function executeVoiceClick() {
            if (lastHovered) {
                lastHovered.click();
                cursorMat.color.set(0xff0000); // Flash rojo
                setTimeout(() => cursorMat.color.set(0x00ffcc), 300);
                if (navigator.vibrate) navigator.vibrate(50);
            }
        }

        // --- 2. THREE.JS & HANDS (Optimizado) ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const cursorMat = new THREE.MeshBasicMaterial({ color: 0x00ffcc, depthTest: false });
        const cursor = new THREE.Mesh(new THREE.RingGeometry(0.08, 0.11, 32), cursorMat);
        scene.add(cursor);

        let lastHovered = null;
        let SENSITIVITY = 2.5;

        function onResults(results) {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const hand = results.multiHandLandmarks[0];
                const index = hand[8];
                
                const dx = index.x - 0.5;
                const dy = index.y - 0.5;

                const screenX = (0.5 - dx * SENSITIVITY) * window.innerWidth;
                const screenY = (0.5 + dy * SENSITIVITY) * window.innerHeight;

                cursor.position.lerp(new THREE.Vector3(dx * SENSITIVITY * -15, dy * SENSITIVITY * -15, 0), 0.3);

                const el = document.elementFromPoint(screenX, screenY);
                if (el !== lastHovered) {
                    if (lastHovered) lastHovered.classList.remove('hover-effect');
                    if (el && el.classList.contains('interactive-btn')) el.classList.add('hover-effect');
                    lastHovered = el;
                }
            }
        }

        const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
        hands.setOptions({ maxNumHands: 1, modelComplexity: 0, minDetectionConfidence: 0.7 });
        hands.onResults(onResults);

        const videoElement = document.getElementById('input_video');
        const cam = new Camera(videoElement, {
            onFrame: async () => { await hands.send({image: videoElement}); },
            width: 640, height: 480
        });
        cam.start();

        function animate() { requestAnimationFrame(animate); renderer.render(scene, camera); }
        animate();
    </script>
</body>
</html>
